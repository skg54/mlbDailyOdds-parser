<!DOCTYPE html>
<html>
  <head>
    <meta content="text/html; charset=UTF-8" http-equiv="content-type">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
    <title>SmartStop Registration</title>
    {{> head}}
  </head>
  <script>
    $(document).ready(function() {

      if (/Mobi|Android/i.test(navigator.userAgent)) {
        // mobile!
        $("#wizardLine").css('max-width', '78%');
        $(".stepText").css('width', '100px');
      }
      
      var emailConfirmed = decodeURIComponent("{{{emailConfirmed}}}");
        console.log('emailConfirmed == '+ emailConfirmed);

      if (emailConfirmed == 0) {
        console.log('emailConfirmed == '+ emailConfirmed);
        var emailConfirmedAlert = '<div class="alert alert-warning alert-dismissible" style="border: 1px solid #ccc;padding: 12px; text-align:left;"><span type="button" class="close" data-dismiss="alert" aria-label="Close" style="position: relative;right: 0px;"><span aria-hidden="true">&times;</span></span>Please confirm your email address.</div>';
        $(emailConfirmedAlert).hide().appendTo("#verifyResponseMessage").fadeIn(100);
        $.toast({
            heading: 'Alert',
            text: 'Please confirm your email address.',
            position: 'top-center',
            stack: false,
            icon: 'warning',
            loader: false
        });
        $('#submitBtn').attr('disabled','disabled');
      } else {
        $('#submitBtn').removeAttr('disabled');
      }

      $("#verifyResponseMessage").on("click", 'span', function(){
        console.log('closeAlert');
        $(this).parent().fadeOut(50);
      });   


      $("#alertDiv").on("click", 'span', function(){
        console.log('closeAlert');
        $(this).parent().fadeOut(50);
      });   

      $("#createAccountForm").submit(function(e) {    

        e.preventDefault();

        $("#loader").fadeIn();
        $("#loaderBG").fadeIn();

        $("#verifyResponseMessage").empty();
        $('#submitBtn').attr('disabled','disabled');

        var postData = "id=" + $('#userID').val();

        $.ajax({   
            type: "POST",
            data : postData,
            cache: false,  
            url: "/scout/account/create",   
            success: function(data) {
              setTimeout(function(){
                $("#loader").hide();
                $("#checkMark").show();
                $("#checkMark").addClass('animate');
                setTimeout(function(){location.href = 'https://smartstop.findmyscout.com/login';},1000);
              },1500);

                console.log("success RES CREATE ACCOUNT == " + JSON.stringify(data));
                $('#submitBtn').removeAttr('disabled');
            }   
        });   

        return false;   
      });

    });

  </script>

  <body>

    <div class="container">
      <div class="background col-sm-6 col-sm-offset-3">
        <div class="logo"></div>
      </div>
    </div>


    <div class="container" style="margin-top: 0px;">

      <div class="row justify-content-center">
        <div class="formDiv col-lg-6 col-sm-offset-3" id="formDiv">

          <div id="loader" style="top: 172px;"></div>
          <div id="checkMark" style="top: 172px;"></div>

          <div id="loaderBG" class="loaderBG" style="width: 100%;height: 100%;position: absolute;z-index: 10;background: #fff;opacity: 0.65;top: 50px;display: none;min-height:400px;">
          </div>

          <!-- Circles which indicates the steps of the form: -->
          <div style="text-align:center;margin-top:10px;">
            <div class="wizardLine" id="wizardLine"></div>

            <ul class="progressWizard">
              <li> <span class="step finish"></span> <span class="stepText register">Register</span></li>
              <li><span class="step finish"></span> <span class="stepText verify">Verify</span></li>
              <li><span class="step finish"></span> <span class="stepText students">Students</span></li>
              <li><span class="step finish"></span> <span class="stepText bus">Buses</span></li>
            </ul>
          </div>

          <h1>Finish </h1>

          <h3 id="addedTitle" style="display: block;max-width: 432px;">All set! Click the Create Account button to finalize your SmartStop Account</h3>

          <div class="verifyResponseMessage" id="verifyResponseMessage"></div>

          <form action="/verify/sms" method="post" id="createAccountForm" style="max-width: 432px;">

            <input type="hidden" id="phoneNum" name="phone" value="{{ phone }}">
            <input type="hidden" id="userID" name="userID" value="{{ id }}">

            <button type="submit" class="btn btn-custom" id="submitBtn" style="float:right;">Create Account</button>
          </form>

        </div>
      </div>
    </div>

  </body>
</html>
